# 工作流程的名稱
name: Deploy Blazor WASM to GitHub Pages

# 觸發條件：當推送到 main 或 master 分支時執行
on:
  push:
    branches: [ main, master ]

# 工作內容
jobs:
  build-and-deploy:
    # 執行此工作的虛擬機器環境
    runs-on: ubuntu-latest

    steps:
      # 步驟 1: 抓取你的程式碼
      - name: Checkout
        uses: actions/checkout@v3

      # 步驟 2: 安裝 .NET 8 SDK
      - name: Setup .NET
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: '8.0.x'

      # 步驟 3: 【終極修正】使用單一指令發佈專案成 Blazor WASM
      # -p:BlazorEnableCompression=false 參數是為了避免 GitHub Pages 上的壓縮問題
      # -p:PublishDir=release/wwwroot/ 參數直接指定輸出到我們需要的資料夾
      - name: Publish .NET Project as WASM
        run: dotnet publish Blazor_from/Blazor_from.csproj -c Release -p:BlazorEnableCompression=false -p:PublishDir=release/wwwroot/ --nologo
      
      # 步驟 4: 修改 base href，現在我們可以安全地修改這個由 publish 指令產生的檔案
      - name: Change base-tag in index.html
        run: sed -i 's/<base href="\/" \/>/<base href="\/Blazor_from\/" \/>/g' release/wwwroot/index.html

      # 步驟 5: 使用社群開發的強大 Action 來部署檔案
      - name: Deploy to GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: gh-pages # 部署到 gh-pages 分支
          folder: release/wwwroot # 從這個資料夾部署

